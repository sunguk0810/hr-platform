server:
  port: 8080

spring:
  application:
    name: gateway-service

  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins:
              - "http://localhost:3000"
            allowed-methods:
              - GET
              - POST
              - PUT
              - PATCH
              - DELETE
              - OPTIONS
            allowed-headers:
              - "*"
            exposed-headers:
              - "X-Request-ID"
              - "X-Correlation-ID"
            allow-credentials: true
            max-age: 3600

      routes:
        # Auth Service
        - id: auth-service
          uri: lb://auth-service
          predicates:
            - Path=/api/v1/auth/**
          filters:
            - RewritePath=/api/v1/auth/(?<segment>.*), /api/v1/auth/${segment}

        # Tenant Service
        - id: tenant-service
          uri: lb://tenant-service
          predicates:
            - Path=/api/v1/tenants/**
          filters:
            - RewritePath=/api/v1/tenants/(?<segment>.*), /api/v1/tenants/${segment}

        # MDM Service
        - id: mdm-service
          uri: lb://mdm-service
          predicates:
            - Path=/api/v1/mdm/**
          filters:
            - RewritePath=/api/v1/mdm/(?<segment>.*), /api/v1/mdm/${segment}

        # Organization Service
        - id: organization-service
          uri: lb://organization-service
          predicates:
            - Path=/api/v1/organizations/**, /api/v1/departments/**, /api/v1/positions/**
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/${segment}

        # Employee Service
        - id: employee-service
          uri: lb://employee-service
          predicates:
            - Path=/api/v1/employees/**
          filters:
            - RewritePath=/api/v1/employees/(?<segment>.*), /api/v1/employees/${segment}

        # Attendance Service
        - id: attendance-service
          uri: lb://attendance-service
          predicates:
            - Path=/api/v1/attendances/**, /api/v1/leaves/**, /api/v1/overtimes/**
          filters:
            - RewritePath=/api/v1/(?<segment>.*), /api/v1/${segment}

        # Approval Service
        - id: approval-service
          uri: lb://approval-service
          predicates:
            - Path=/api/v1/approvals/**
          filters:
            - RewritePath=/api/v1/approvals/(?<segment>.*), /api/v1/approvals/${segment}

        # Notification Service
        - id: notification-service
          uri: lb://notification-service
          predicates:
            - Path=/api/v1/notifications/**
          filters:
            - RewritePath=/api/v1/notifications/(?<segment>.*), /api/v1/notifications/${segment}

        # File Service
        - id: file-service
          uri: lb://file-service
          predicates:
            - Path=/api/v1/files/**
          filters:
            - RewritePath=/api/v1/files/(?<segment>.*), /api/v1/files/${segment}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/hr-saas}

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:redis_password}

resilience4j:
  circuitbreaker:
    configs:
      default:
        sliding-window-size: 10
        minimum-number-of-calls: 5
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10000
        permitted-number-of-calls-in-half-open-state: 3
  timelimiter:
    configs:
      default:
        timeout-duration: 30s

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,gateway
  endpoint:
    gateway:
      enabled: true
    health:
      show-details: always

gateway:
  rate-limit:
    enabled: true
    default-max-requests: 100
    default-window: 1m
    paths:
      /api/v1/auth/login:
        max-requests: 10
        window: 1m
      /api/v1/auth/password/reset:
        max-requests: 5
        window: 1m
      /api/v1/files/**:
        max-requests: 50
        window: 1m
    role-based-limits:
      SYSTEM_ADMIN: 1000
      TENANT_ADMIN: 500
      HR_MANAGER: 300

jwt:
  secret: ${JWT_SECRET:hr-saas-secret-key-for-jwt-token-signing-minimum-256-bits-required}

logging:
  level:
    root: INFO
    com.hrsaas: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG
