# 보안 컴플라이언스 가이드

> **최종 업데이트**: 2026-02-09
> **대상**: 보안 담당자, 개발자, DevOps 엔지니어
> **기준**: ISMS-P, 개인정보보호법(PIPA), OWASP Top 10

---

## 목차

- [1. 개요](#1-개요)
- [2. ISMS-P 대응 현황](#2-isms-p-대응-현황)
- [3. 개인정보보호법 (PIPA) 준수](#3-개인정보보호법-pipa-준수)
- [4. 접근 제어](#4-접근-제어)
- [5. 데이터 암호화](#5-데이터-암호화)
- [6. 감사 로그](#6-감사-로그)
- [7. 개인정보 보호](#7-개인정보-보호)
- [8. OWASP Top 10 대응](#8-owasp-top-10-대응)
- [9. 세션 및 인증 보안](#9-세션-및-인증-보안)
- [10. 네트워크 보안](#10-네트워크-보안)
- [11. 보안 체크리스트](#11-보안-체크리스트)
- [12. 관련 문서](#12-관련-문서)

---

## 1. 개요

HR SaaS 플랫폼은 100+ 계열사의 개인정보를 처리하는 시스템으로, ISMS-P 인증과 개인정보보호법(PIPA) 준수가 필수적입니다.

### 보안 원칙

| 원칙 | 구현 |
|------|------|
| 최소 권한 | RBAC 7단계 역할 + 범위 기반 접근 |
| 심층 방어 | 네트워크 → 인증 → 인가 → RLS → 암호화 |
| 기본 보안 | 암호화 전송, 마스킹 기본 적용 |
| 추적 가능성 | 감사 로그 5년 보관 |

---

## 2. ISMS-P 대응 현황

### 관리체계 수립 및 운영

| 항목 | 요구사항 | 구현 현황 | 상태 |
|------|---------|----------|------|
| 2.1 정책 수립 | 정보보호 정책 수립 | 테넌트별 보안 정책 (SecurityPolicy) | O |
| 2.2 조직 구성 | 보안 조직 구성 | RBAC 역할 기반 관리자 지정 | O |
| 2.3 자산 관리 | IT 자산 식별/관리 | AWS 리소스 태깅, 서비스 인벤토리 | O |

### 보호대책 요구사항

| 항목 | 요구사항 | 구현 | 상태 |
|------|---------|------|------|
| 2.5.1 | 사용자 계정 관리 | 비밀번호 정책, 계정 잠금, 세션 관리 | O |
| 2.5.2 | 접근 권한 관리 | 7단계 RBAC, RLS 테넌트 격리 | O |
| 2.6.1 | 데이터 암호화 | AES-GCM 256비트, TLS 1.2+ | O |
| 2.6.2 | 접근 통제 | SecurityFilter + @PreAuthorize | O |
| 2.6.3 | 로그 관리 | 감사 로그 기록, 보관 정책 | O |
| 2.7.1 | 암호 관리 | 해시(bcrypt), 최소 길이, 복잡도 | O |
| 2.8.1 | 보안 사고 대응 | 알림 시스템, 계정 잠금 | 부분 |

---

## 3. 개인정보보호법 (PIPA) 준수

### 수집 및 이용

| 요구사항 | 구현 | 비고 |
|---------|------|------|
| 수집 목적 명시 | 테넌트별 개인정보 처리 동의 | 설정으로 관리 |
| 최소 수집 | 필수/선택 필드 구분 | DTO 필드별 @NotNull |
| 제3자 제공 동의 | 계열사 간 이동 시 동의 | TransferRequest |

### 안전성 확보 조치

| 조치사항 | 구현 | 상세 |
|---------|------|------|
| **접근 제어** | RBAC + RLS | 역할별 데이터 접근 범위 제한 |
| **접근 기록** | 감사 로그 | 개인정보 열람/수정 기록 |
| **암호화 전송** | TLS 1.2+ | HTTPS 강제 (프로덕션) |
| **암호화 저장** | AES-GCM 256 | 주민등록번호, 계좌번호 등 |
| **마스킹** | 8종 마스킹 | 이름, 전화, 이메일, 주소 등 |
| **보관 기간** | 테넌트별 설정 | 퇴직 후 보존 기간 설정 가능 |
| **파기** | SoftDelete + 물리 삭제 | 보존 기간 만료 후 삭제 |

### 개인정보 처리 대상

| 분류 | 필드 | 마스킹 | 암호화 |
|------|------|:------:|:------:|
| 일반 개인정보 | 이름, 이메일, 전화번호 | O | - |
| 민감 개인정보 | 주민등록번호 | O | O |
| 금융 정보 | 계좌번호, 카드번호 | O | O |
| 주소 정보 | 주소 | O | - |

---

## 4. 접근 제어

### 4.1 역할 기반 접근 제어 (RBAC)

7단계 역할 계층을 통해 데이터 접근을 제어합니다:

```
SUPER_ADMIN → GROUP_ADMIN → TENANT_ADMIN → HR_MANAGER
→ DEPT_MANAGER → TEAM_LEADER → EMPLOYEE
```

### 4.2 데이터 범위 제어

| 역할 | 데이터 범위 | 인사정보 | 급여정보 |
|------|-----------|---------|---------|
| SUPER_ADMIN | 전체 테넌트 | 원본 | 원본 |
| TENANT_ADMIN | 해당 테넌트 | 원본 | 원본 |
| HR_MANAGER | 해당 테넌트 | 원본 | 원본 |
| DEPT_MANAGER | 소속 부서 | 마스킹 | 접근 불가 |
| TEAM_LEADER | 소속 팀 | 마스킹 | 접근 불가 |
| EMPLOYEE | 본인 | 원본 | 원본 (본인) |

### 4.3 Row Level Security (DB)

PostgreSQL RLS로 DB 레벨에서 테넌트 격리를 강제합니다. 애플리케이션 코드의 실수와 관계없이 다른 테넌트 데이터에 접근할 수 없습니다.

> 상세: [MULTI_TENANCY.md](../architecture/MULTI_TENANCY.md)

---

## 5. 데이터 암호화

### 5.1 전송 구간 암호화

| 구간 | 프로토콜 | 구현 |
|------|---------|------|
| 클라이언트 → ALB | TLS 1.2+ | ACM 인증서, HTTPS 강제 |
| ALB → ECS | HTTP | VPC 내부, Private 서브넷 |
| ECS → RDS | TLS | `rds.force_ssl=1` |
| ECS → ElastiCache | TLS | 전송 암호화 활성화 |

### 5.2 저장 데이터 암호화

| 대상 | 방식 | 키 관리 |
|------|------|---------|
| RDS | AWS KMS (디스크 암호화) | AWS 관리형 키 |
| ElastiCache | 저장 데이터 암호화 | AWS 관리형 키 |
| S3 | SSE-S3 | AWS 관리형 키 |
| 민감 필드 | AES-GCM 256 (앱 레벨) | Secrets Manager |

### 5.3 앱 레벨 암호화 (AES-GCM)

```java
// common/common-privacy/EncryptionService.java
// 알고리즘: AES/GCM/NoPadding
// 키: 256비트 (Base64 인코딩, Secrets Manager에서 주입)
// IV: 12바이트 (랜덤, 매 암호화마다 새로 생성)
// 인증 태그: 128비트 (무결성 검증)
```

> 상세: [SECURITY_PATTERNS.md](../architecture/SECURITY_PATTERNS.md)

---

## 6. 감사 로그

### 6.1 기록 대상

| 이벤트 | 기록 내용 | 보관 기간 |
|--------|---------|----------|
| 로그인/로그아웃 | 사용자, IP, 시간, 결과 | 5년 |
| 개인정보 조회 | 조회자, 대상, 필드, 시간 | 5년 |
| 개인정보 수정 | 수정자, 대상, 변경 전/후 | 5년 |
| 권한 변경 | 변경자, 대상, 역할 변경 | 5년 |
| 데이터 삭제 | 삭제자, 대상, 시간 | 영구 |
| 마스킹 해제 | 요청자, 대상, 필드, 사유 | 5년 |

### 6.2 JPA Auditing

모든 엔티티에 자동으로 감사 필드가 기록됩니다:

| 필드 | 어노테이션 | 값 |
|------|----------|------|
| `created_at` | `@CreatedDate` | 생성 시각 |
| `updated_at` | `@LastModifiedDate` | 수정 시각 |
| `created_by` | `@CreatedBy` | 생성자 ID |
| `updated_by` | `@LastModifiedBy` | 수정자 ID |

### 6.3 로그 보관

| 환경 | 저장소 | 보관 기간 |
|------|--------|----------|
| 로컬 | 콘솔/파일 | 세션 |
| 프로덕션 | CloudWatch Logs | 5년 (감사) / 90일 (운영) |
| 감사 DB | PostgreSQL (hr_audit 스키마) | 5년 |

---

## 7. 개인정보 보호

### 7.1 마스킹

`PrivacyFilter`와 `@Masked` 어노테이션으로 자동 마스킹:

| 유형 | 원본 | 마스킹 결과 |
|------|------|-----------|
| 이름 | 홍길동 | 홍\*동 |
| 전화 | 010-1234-5678 | 010-\*\*\*\*-5678 |
| 이메일 | user@example.com | us\*\*\*@example.com |
| 주민번호 | 900101-1234567 | 900101-\*\*\*\*\*\*\* |
| 계좌번호 | 123-456-789012 | 123-\*\*\*-\*\*\*012 |
| 주소 | 서울시 강남구 삼성동 123 | 서울시 강남구 \*\*\* |

### 7.2 마스킹 예외 조건

| 조건 | 마스킹 적용 |
|------|-----------|
| SUPER_ADMIN / TENANT_ADMIN / HR_ADMIN 역할 | 미적용 (원본) |
| 본인 데이터 조회 | 미적용 (원본) |
| 그 외 | 적용 |

---

## 8. OWASP Top 10 대응

| 취약점 | 대응 |
|--------|------|
| A01 접근 제어 취약 | RBAC + RLS + @PreAuthorize |
| A02 암호화 실패 | AES-GCM, TLS, bcrypt |
| A03 인젝션 | Spring Data JPA (파라미터 바인딩), 입력 검증 |
| A04 안전하지 않은 설계 | 비즈니스 로직 검증, State Machine |
| A05 보안 설정 오류 | Spring Security 기본 보안, CORS 제한 |
| A06 취약 컴포넌트 | Gradle 의존성 관리, 정기 업데이트 |
| A07 인증 실패 | JWT, 세션 관리, 계정 잠금 |
| A08 무결성 검증 실패 | AES-GCM 인증 태그, HMAC-SHA256 |
| A09 로깅 실패 | 감사 로그, CloudWatch |
| A10 SSRF | 외부 URL 접근 제한, VPC 엔드포인트 |

---

## 9. 세션 및 인증 보안

| 항목 | 설정 |
|------|------|
| 세션 방식 | Stateless JWT |
| Access Token 만료 | 30분 |
| Refresh Token 만료 | 7일 |
| 동시 세션 제한 | 5개/사용자 |
| 로그인 실패 잠금 | 5회 실패 → 30분 잠금 |
| 비밀번호 해시 | bcrypt |
| 토큰 블랙리스트 | Redis (로그아웃 시) |
| CSRF | 비활성화 (JWT 기반 Stateless) |

---

## 10. 네트워크 보안

| 영역 | 대책 |
|------|------|
| VPC | Private 서브넷 (앱, DB) |
| 보안 그룹 | 최소 포트 개방 (ALB→ECS, ECS→RDS) |
| VPC 엔드포인트 | ECR, S3, SQS, SNS, Secrets Manager |
| NAT Gateway | 아웃바운드만 허용 |
| WAF | ALB에 WAF 연동 (향후) |

---

## 11. 보안 체크리스트

### 배포 전 확인

- [ ] 모든 API에 인증 적용 (@PreAuthorize 또는 permitAll 명시)
- [ ] SecurityConfig에 FilterRegistrationBean 포함
- [ ] 민감 필드에 @Masked 적용
- [ ] 주민번호 등 암호화 필드 확인
- [ ] RLS 정책 적용 확인 (Flyway V3, V4)
- [ ] CORS Origin 제한 (프로덕션)
- [ ] leak-detection-threshold 비활성화 (프로덕션)
- [ ] JWT Secret 키 Secrets Manager 저장
- [ ] DB SSL 강제 (rds.force_ssl=1)
- [ ] CloudWatch Logs 보관 정책 설정

### 정기 점검

- [ ] 의존성 취약점 스캔 (월 1회)
- [ ] 접근 권한 검토 (분기 1회)
- [ ] 감사 로그 검토 (월 1회)
- [ ] 비밀번호 만료 계정 확인 (월 1회)
- [ ] 미사용 계정 비활성화 (분기 1회)

---

## 12. 관련 문서

| 문서 | 설명 |
|------|------|
| [SECURITY_PATTERNS.md](../architecture/SECURITY_PATTERNS.md) | JWT, RBAC, 마스킹 구현 상세 |
| [MULTI_TENANCY.md](../architecture/MULTI_TENANCY.md) | RLS 테넌트 격리 |
| [AWS_INFRASTRUCTURE.md](./AWS_INFRASTRUCTURE.md) | VPC, 보안 그룹, 암호화 |
| [docs/modules/01-AUTH-SERVICE.md](../modules/01-AUTH-SERVICE.md) | 인증 서비스 정책 |
| [docs/modules/05-EMPLOYEE-SERVICE.md](../modules/05-EMPLOYEE-SERVICE.md) | 개인정보 처리 정책 |
