# ===========================================
# Gateway Service Configuration
# ===========================================

spring:
  cloud:
    loadbalancer:
      enabled: false
    discovery:
      enabled: false
    gateway:
      discovery:
        locator:
          enabled: false
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins:
              - http://localhost:3000
              - http://localhost:5173
            allowed-methods:
              - GET
              - POST
              - PUT
              - PATCH
              - DELETE
              - OPTIONS
            allowed-headers:
              - "*"
            exposed-headers:
              - X-Request-ID
              - X-Correlation-ID
            allow-credentials: true
            max-age: 3600

      routes:
        # Auth Service
        - id: auth-service
          uri: ${service.urls.auth}
          predicates:
            - Path=/api/v1/auth/**

        # Tenant Service
        - id: tenant-service
          uri: ${service.urls.tenant}
          predicates:
            - Path=/api/v1/tenants/**

        # MDM Service
        - id: mdm-service
          uri: ${service.urls.mdm}
          predicates:
            - Path=/api/v1/mdm/**, /api/v1/menus/**, /api/v1/admin/menus/**

        # Organization Service
        - id: organization-service
          uri: ${service.urls.organization}
          predicates:
            - Path=/api/v1/organizations/**, /api/v1/departments/**, /api/v1/positions/**, /api/v1/grades/**, /api/v1/announcements/**, /api/v1/committees/**, /api/v1/headcounts/**

        # Employee Service
        - id: employee-service
          uri: ${service.urls.employee}
          predicates:
            - Path=/api/v1/employees/**, /api/v1/condolences/**, /api/v1/transfers/**

        # Attendance Service
        - id: attendance-service
          uri: ${service.urls.attendance}
          predicates:
            - Path=/api/v1/attendances/**, /api/v1/leaves/**, /api/v1/overtimes/**

        # Approval Service
        - id: approval-service
          uri: ${service.urls.approval}
          predicates:
            - Path=/api/v1/approvals/**

        # Notification Service
        - id: notification-service
          uri: ${service.urls.notification}
          predicates:
            - Path=/api/v1/notifications/**

        # File Service
        - id: file-service
          uri: ${service.urls.file}
          predicates:
            - Path=/api/v1/files/**

        # Recruitment Service
        - id: recruitment-service
          uri: ${service.urls.recruitment}
          predicates:
            - Path=/api/v1/jobs/**, /api/v1/applications/**, /api/v1/interviews/**, /api/v1/offers/**

        # Appointment Service
        - id: appointment-service
          uri: ${service.urls.appointment}
          predicates:
            - Path=/api/v1/appointments/**

        # Certificate Service
        - id: certificate-service
          uri: ${service.urls.certificate}
          predicates:
            - Path=/api/v1/certificates/**

resilience4j:
  circuitbreaker:
    configs:
      default:
        sliding-window-size: 10
        minimum-number-of-calls: 5
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10000
        permitted-number-of-calls-in-half-open-state: 3
  timelimiter:
    configs:
      default:
        timeout-duration: 30s

management:
  endpoint:
    gateway:
      enabled: true
  health:
    discovery:
      enabled: false
    config:
      enabled: false
